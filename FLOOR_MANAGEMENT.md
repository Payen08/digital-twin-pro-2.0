# 多楼层管理功能说明

## 功能概述

已在 Digital Twin Pro 项目中实现了完整的多楼层管理功能，支持创建、编辑、删除和切换不同楼层场景。

## 功能特性

### 1. 楼层状态管理
- **楼层列表** (`floors`): 存储所有楼层信息
- **当前楼层** (`currentFloorId`): 跟踪当前选中的楼层
- **楼层数据结构**:
  ```javascript
  {
    id: string,          // 唯一标识
    name: string,        // 楼层名称（如"1楼"）
    description: string, // 楼层描述
    baseMapId: string,   // 关联的底图ID
    objects: []          // 该楼层的3D对象列表
  }
  ```

### 2. 左侧楼层切换UI
位置：左侧面板底部

功能：
- 显示所有楼层列表
- 当前楼层高亮显示（蓝色背景）
- 点击切换到不同楼层
- 齿轮图标打开场景管理对话框

### 3. 场景管理对话框
功能：
- **新增场景**：点击"+ 新增场景"按钮创建新楼层
- **楼层列表**：显示所有楼层卡片
- **编辑**：点击编辑按钮修改楼层信息
- **删除**：点击删除按钮移除楼层（至少保留一个）

### 4. 编辑场景对话框
可编辑字段：
- 场景名称
- 场景基础数据源
- 底图选择
- 是否初始化地图关联设备

## UI布局

### 左侧面板底部
```
┌─────────────────────┐
│ 楼层          ⚙️    │
├─────────────────────┤
│ 🏢 1楼 (蓝色高亮)   │
│ 🏢 2楼              │
│ 🏢 3楼              │
└─────────────────────┘
```

### 场景管理对话框
```
┌─────────────────────────────┐
│ 场景管理               ✕    │
├─────────────────────────────┤
│ [+ 新增场景]                │
│                             │
│ ┌─────────────────────────┐ │
│ │ 1楼          ✏️ 🗑️     │ │
│ │ 建筑主体地图            │ │
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │ 2楼          ✏️ 🗑️     │ │
│ │ 设备分布地图            │ │
│ └─────────────────────────┘ │
├─────────────────────────────┤
│                    [关闭]   │
└─────────────────────────────┘
```

## 使用方法

### 创建新楼层
1. 点击左侧面板底部的齿轮图标
2. 在场景管理对话框中点击"+ 新增场景"
3. 新楼层会自动命名为"N楼"（N为楼层序号）

### 切换楼层
1. 在左侧面板底部的楼层列表中
2. 点击要切换的楼层按钮
3. 当前楼层会以蓝色高亮显示

### 编辑楼层
1. 打开场景管理对话框
2. 点击楼层卡片右上角的编辑图标（✏️）
3. 在编辑对话框中修改楼层信息
4. 点击"确定"保存更改

### 删除楼层
1. 打开场景管理对话框
2. 点击楼层卡片右上角的删除图标（🗑️）
3. 确认删除操作
4. 注意：至少需要保留一个楼层

## 技术实现

### 状态管理
```javascript
// 楼层管理状态
const [floors, setFloors] = useState([
    { id: '1', name: '1楼', description: '建筑主体地图', baseMapId: null, objects: [] }
]);
const [currentFloorId, setCurrentFloorId] = useState('1');
const [showFloorManager, setShowFloorManager] = useState(false);
const [editingFloor, setEditingFloor] = useState(null);
```

### 组件位置
- **楼层切换UI**: `src/App.jsx` 第 2717-2745 行
- **场景管理对话框**: `src/App.jsx` 第 2664-2743 行
- **编辑场景对话框**: `src/App.jsx` 第 2745-2816 行

## 后续扩展建议

### 1. 楼层数据持久化
- 将楼层数据保存到 localStorage 或后端
- 实现楼层数据的导入导出

### 2. 楼层对象隔离
- 每个楼层维护独立的对象列表
- 切换楼层时只显示当前楼层的对象

### 3. 底图关联
- 支持为每个楼层设置不同的 SLAM 底图
- 实现底图的自动加载和切换

### 4. 楼层间对象复制
- 支持将对象从一个楼层复制到另一个楼层
- 实现楼层模板功能

### 5. 楼层可视化
- 在 3D 视图中显示楼层高度差
- 支持楼层的垂直堆叠显示

## 注意事项

1. **最小楼层数**：系统至少保留一个楼层，无法删除最后一个楼层
2. **楼层ID**：使用时间戳作为唯一ID，确保不会重复
3. **当前楼层**：删除当前楼层时，会自动切换到第一个楼层
4. **数据同步**：目前楼层切换不会自动保存场景数据，需要手动保存

## 图标说明

- 🏢 `Layers`: 楼层图标
- ⚙️ `Settings`: 设置/管理图标
- ✏️ `Edit3`: 编辑图标
- 🗑️ `Trash2`: 删除图标
- ➕ `Plus`: 添加图标
- ✕ `X`: 关闭图标
