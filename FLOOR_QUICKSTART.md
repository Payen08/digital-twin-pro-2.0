# 多楼层管理功能 - 快速启动

## 🚀 启动项目

```bash
cd "/Volumes/Payen 西部/APP制作/3d编辑/digital-twin-pro"
npm run dev
```

项目将在 `http://localhost:5173` 启动

## ✅ 已实现的功能

### 1. 左侧楼层切换面板
- 位置：左侧面板最底部
- 功能：
  - 显示所有楼层列表
  - 点击切换楼层
  - 当前楼层蓝色高亮
  - 齿轮图标打开管理界面

### 2. 场景管理对话框
- 触发：点击楼层面板的齿轮图标
- 功能：
  - 新增场景（+ 新增场景按钮）
  - 查看所有楼层
  - 编辑楼层信息
  - 删除楼层（至少保留一个）

### 3. 编辑场景对话框
- 触发：点击楼层卡片的编辑图标
- 可编辑：
  - 场景名称
  - 场景基础数据源
  - 底图选择
  - 是否初始化地图关联设备

## 📝 使用流程

### 创建新楼层
1. 点击左侧底部的 ⚙️ 图标
2. 点击 "+ 新增场景" 按钮
3. 新楼层自动创建（命名为"N楼"）
4. 点击"关闭"返回

### 切换楼层
1. 在左侧底部找到楼层列表
2. 点击要切换的楼层按钮
3. 当前楼层会变成蓝色

### 编辑楼层
1. 打开场景管理对话框（⚙️）
2. 点击楼层卡片右上角的 ✏️ 图标
3. 修改楼层名称等信息
4. 点击"确定"保存

### 删除楼层
1. 打开场景管理对话框（⚙️）
2. 点击楼层卡片右上角的 🗑️ 图标
3. 确认删除
4. 注意：至少保留一个楼层

## 🎨 UI预览

### 左侧楼层面板
```
┌─────────────────────┐
│ 楼层          ⚙️    │
├─────────────────────┤
│ 🏢 1楼 (蓝色)       │
│ 🏢 2楼              │
│ 🏢 3楼              │
└─────────────────────┘
```

### 场景管理对话框
```
┌─────────────────────────────┐
│ 场景管理               ✕    │
├─────────────────────────────┤
│ [+ 新增场景]                │
│                             │
│ ┌─────────────────────────┐ │
│ │ 1楼          ✏️ 🗑️     │ │
│ │ 建筑主体地图            │ │
│ └─────────────────────────┘ │
├─────────────────────────────┤
│                    [关闭]   │
└─────────────────────────────┘
```

## 🔧 技术细节

### 修改的文件
- `src/App.jsx`
  - 添加楼层状态管理（第 1635-1641 行）
  - 添加楼层切换UI（第 2717-2745 行）
  - 添加场景管理对话框（第 2664-2743 行）
  - 添加编辑场景对话框（第 2745-2816 行）
  - 导入 Layers 图标（第 10 行）

### 新增状态
```javascript
const [floors, setFloors] = useState([...]);      // 楼层列表
const [currentFloorId, setCurrentFloorId] = useState('1'); // 当前楼层
const [showFloorManager, setShowFloorManager] = useState(false); // 管理对话框
const [editingFloor, setEditingFloor] = useState(null); // 编辑中的楼层
```

## 📦 依赖项
所有必需的依赖已在 `package.json` 中：
- `lucide-react`: 图标库（包含 Layers, Settings, Edit3, Trash2 等）
- `react`: UI框架
- `@react-three/fiber`: 3D渲染
- `tailwindcss`: 样式

## 🐛 已知限制

1. **数据持久化**：楼层数据暂未持久化，刷新页面会重置
2. **对象隔离**：不同楼层的对象暂未隔离，所有对象在同一场景中
3. **底图关联**：底图选择功能暂为占位符，未实际关联SLAM地图

## 🚧 后续开发建议

### 优先级高
1. **楼层对象隔离**
   - 每个楼层维护独立的对象列表
   - 切换楼层时只显示当前楼层对象

2. **数据持久化**
   - 保存到 localStorage
   - 或集成后端API

### 优先级中
3. **底图关联**
   - 支持为每个楼层设置不同SLAM底图
   - 自动加载对应底图

4. **楼层模板**
   - 支持复制楼层
   - 支持导入导出楼层配置

### 优先级低
5. **3D可视化增强**
   - 楼层高度差显示
   - 楼层垂直堆叠视图

## 📞 问题反馈

如遇到问题，请检查：
1. Node.js 版本 >= 18
2. 依赖是否正确安装（`npm install`）
3. 浏览器控制台是否有错误
4. Vite 开发服务器是否正常运行

## 🎉 测试建议

1. 启动项目后，检查左侧底部是否显示"楼层"面板
2. 点击齿轮图标，确认场景管理对话框正常打开
3. 尝试创建新楼层，确认楼层列表更新
4. 尝试切换楼层，确认高亮状态正确
5. 尝试编辑和删除楼层，确认功能正常

---

**版本**: 1.0.0  
**最后更新**: 2025-11-24  
**作者**: Digital Twin Pro Team
