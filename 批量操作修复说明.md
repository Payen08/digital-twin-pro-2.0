# 批量操作功能修复说明

## 🐛 发现的问题

1. **使用了 Three.js 对象而不是 objects 数组** - 导致修改不生效
2. **对齐算法过于复杂** - 使用了包围盒计算，应该简化为位置对齐
3. **复制功能有问题** - 需要使用 objects 数组而不是 Three.js 对象
4. **组合功能未实现** - 需要创建 Group 类型的对象

## ✅ 已修复

1. **位置、旋转、缩放编辑** - 现在使用 objects 数组和 setObjects
2. **显示平均值** - 正确计算所有选中对象的平均值
3. **相对偏移** - 修改值时使用偏移量，保持对象间距

## 🔧 需要进一步简化

### 对齐功能
应该简化为：
- **左对齐** - 所有对象X坐标对齐到最左边对象
- **居中** - 所有对象X坐标对齐到平均X位置
- **右对齐** - 所有对象X坐标对齐到最右边对象

### 复制功能
```javascript
const handleBatchDuplicate = (selectedIds) => {
    const newObjects = [];
    selectedIds.forEach(id => {
        const obj = objects.find(o => o.id === id);
        if (obj) {
            const newObj = {
                ...obj,
                id: uuidv4(),
                name: `${obj.name} 副本`,
                position: [obj.position[0] + 2, obj.position[1], obj.position[2]]
            };
            newObjects.push(newObj);
        }
    });
    const allObjects = [...objects, ...newObjects];
    setObjects(allObjects);
    commitHistory(allObjects);
    // 选中新对象
    setSelectedIds(newObjects.map(o => o.id));
};
```

### 组合功能
```javascript
const handleBatchGroup = (selectedIds) => {
    // 计算中心点
    const avgX = selectedIds.reduce((sum, id) => {
        const obj = objects.find(o => o.id === id);
        return sum + (obj?.position[0] || 0);
    }, 0) / selectedIds.length;
    
    const avgY = selectedIds.reduce((sum, id) => {
        const obj = objects.find(o => o.id === id);
        return sum + (obj?.position[1] || 0);
    }, 0) / selectedIds.length;
    
    const avgZ = selectedIds.reduce((sum, id) => {
        const obj = objects.find(o => o.id === id);
        return sum + (obj?.position[2] || 0);
    }, 0) / selectedIds.length;
    
    // 创建组对象
    const groupObj = {
        id: uuidv4(),
        type: 'group',
        name: `组合 ${Date.now()}`,
        position: [avgX, avgY, avgZ],
        rotation: [0, 0, 0],
        scale: [1, 1, 1],
        children: selectedIds,
        visible: true,
        locked: false
    };
    
    // 移除原对象，添加组
    const newObjects = objects.filter(o => !selectedIds.includes(o.id));
    newObjects.push(groupObj);
    setObjects(newObjects);
    commitHistory(newObjects);
    setSelectedIds([groupObj.id]);
};
```

## 💡 建议

由于当前实现过于复杂，建议：

1. **简化对齐功能** - 只保留基本的位置对齐
2. **移除包围盒计算** - 使用简单的位置比较
3. **修复复制功能** - 使用 objects 数组操作
4. **实现组合功能** - 创建 group 类型对象

## 🎯 下一步

需要重写以下部分：
- [ ] 对齐按钮（6个）
- [ ] 分布按钮（2个）
- [ ] 复制功能
- [ ] 组合功能
- [ ] 删除功能

是否需要我重写这些功能？
